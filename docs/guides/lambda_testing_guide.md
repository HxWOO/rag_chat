# Lambda 함수 효율적으로 테스트하는 방법

S3 업로드나 API 호출과 같은 외부 트리거에 의존하여 Lambda 함수를 테스트하는 것은 시간이 많이 걸리고 비효율적입니다. AWS Lambda 콘솔의 **'Test' 기능**을 사용하면 함수를 직접, 그리고 반복적으로 실행하여 개발 및 디버깅 속도를 크게 향상시킬 수 있습니다.

이 가이드에서는 `embedding-function`을 예시로 설명합니다.

## 1단계: 테스트용 소규모 자산 준비 (최초 1회)

테스트를 위해 실제 운영 환경에서 사용하는 큰 데이터 대신, 작고 관리하기 쉬운 테스트용 자산을 준비합니다.

1.  **테스트용 PDF 생성:** 1~2페이지 분량의 작은 PDF 파일을 준비합니다. 이 파일은 텍스트, 목록, 테이블 등 처리 로직이 검증해야 할 다양한 요소를 포함하는 것이 좋습니다.
2.  **S3에 업로드:** 이 테스트용 PDF 파일을 S3 버킷에 업로드합니다. 이 파일은 테스트 케이스를 실행할 때마다 재사용될 것입니다.
    *   예: `s3://your-bucket-name/test-docs/test-manual.pdf`

## 2단계: Lambda 콘솔에서 테스트 이벤트 구성 (최초 1회)

Lambda 함수를 직접 호출하기 위해, 실제 S3 이벤트와 동일한 구조를 가진 '모의(Mock) 테스트 이벤트'를 생성합니다.

1.  AWS Lambda 콘솔에서 테스트할 함수(`embedding-function`)의 상세 페이지로 이동합니다.
2.  상단의 **'Test'** 탭을 선택합니다.
3.  'Test event' 섹션에서 **'Create new event'**를 선택합니다.
4.  **Event name:** `S3PutTestPDF`와 같이 테스트 케이스를 식별할 수 있는 명확한 이름을 입력합니다.
5.  **Event sharing:** `Private` (기본값)를 선택합니다.
6.  **Template:** 드롭다운 목록에서 **`s3-put`**을 검색하여 선택합니다. 이 템플릿은 S3 파일 업로드 이벤트의 기본 JSON 구조를 제공합니다.
7.  템플릿이 선택되면, 아래 JSON 에디터에서 **두 곳의 값을 수정**해야 합니다.
    *   `Records[0].s3.bucket.name`: **1단계**에서 업로드한 버킷의 실제 이름으로 변경합니다.
    *   `Records[0].s3.object.key`: **1단계**에서 업로드한 테스트 PDF 파일의 실제 경로(Key)로 변경합니다.

    **수정 예시:**
    ```json
    {
      "Records": [
        {
          ...
          "s3": {
            ...
            "bucket": {
              "name": "hyun-rag-test-bucket",  // <-- 실제 버킷 이름으로 변경
              "arn": "arn:aws:s3:::hyun-rag-test-bucket"
            },
            "object": {
              "key": "test-docs/test-manual.pdf", // <-- 실제 테스트 파일 경로로 변경
              ...
            }
          }
        }
      ]
    }
    ```
8.  수정이 끝나면 오른쪽 상단의 **'Save'** 버튼을 눌러 테스트 이벤트를 저장합니다.

## 3단계: 테스트 실행 및 결과 확인

이제 모든 준비가 끝났습니다. 코드나 설정을 변경한 후, 아래의 과정으로 빠르게 테스트를 진행할 수 있습니다.

1.  'Test' 탭으로 이동합니다.
2.  방금 생성한 `S3PutTestPDF` 이벤트가 선택되어 있는지 확인합니다.
3.  오른쪽 상단의 주황색 **'Test'** 버튼을 클릭합니다.
4.  Lambda 함수가 즉시 실행되고, 잠시 후 실행 결과가 화면에 나타납니다.
    *   **Status:** `Succeeded` 또는 `Failed`
    *   **Function Logs:** `print` 문을 포함한 전체 실행 로그(CloudWatch Logs)가 표시됩니다. 에러가 발생하면 이곳에서 스택 트레이스(Stack Trace)를 확인하여 원인을 파악할 수 있습니다.

이 방법을 사용하면 S3에 파일을 매번 업로드하는 번거로움 없이, 코드를 수정한 후 즉시 결과를 확인하는 빠른 개발 사이클을 가져갈 수 있습니다.
